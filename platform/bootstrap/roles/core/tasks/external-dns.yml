- name: Ensure external-dns namespace
  kubernetes.core.k8s:
    state: present
    api_version: v1
    kind: Namespace
    name: external-dns
  when: init_namespaces

- include_role:
    name: install_component
  vars:
    component_name: external-dns
    component_version: 0.1.0
    component_namespace: external-dns
    component_values:
      domainFilter: '{{ dns.domain_filter | default(omit) }}'
      provider: '{{ dns.provider }}'
      cloudflare:
        proxied: '{{ dns.proxied | default(True) }}'
        zoneId: '{{ dns.hosted_zone_id | default(omit)}}'
        secret: '{{ dns.secret_ref | default(omit) }}'
      route53:
        zoneType: '{{ dns.hosted_zone_type | default(omit)}}'
        zoneId: '{{ dns.hosted_zone_id | default(omit)}}'
        eksRole: '{{ dns.eks_role | default(omit)}}'
        iamRole: '{{ dns.iam_role | default(omit) }}'
