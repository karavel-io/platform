apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-cm
  namespace: {{ .Release.Namespace | quote }}
  labels:
    app.kubernetes.io/name: argocd-cm
    helm.sh/chart: {{ include "argocd.chart" . }}
    app.kubernetes.io/instance: argocd
    app.kubernetes.io/part-of: argocd
    app.kubernetes.io/component: server
data:
    application.instanceLabelKey: argocd.argoproj.io/instance
    url: "https://{{ .Values.publicHost }}"
    admin.enabled: "false"
    repositories: |
      - name: karavel
        type: helm
        url: https://charts.mikamai.com/karavel
      - url: {{ .Values.git.repo }}
        usernameSecret:
          name: infrastructure-repo-secret
          key: username
        passwordSecret:
          name: infrastructure-repo-secret
          key: password
        sshPrivateKeySecret:
          name: infrastructure-repo-secret
          key: sshPrivateKey
    {{- with .Values.oidc.config }}
    oidc.config: |
      name: {{ .name }}
      issuer: {{ .issuer }}
      clientID: {{ .clientID }}
      clientSecret: {{ .clientSecret }}
      requestedScopes: {{ .requestedScopes }}
    {{- end }}
