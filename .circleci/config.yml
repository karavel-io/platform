version: 2.1

workflows:
  default:
    jobs:
      - helm-lint
      - docs-build:
          requires:
            - helm-lint
          filters:
            branches:
              only:
                - master

jobs:
  helm-lint:
    docker:
      - image: quay.io/helmpack/chart-testing:v3.3.1
    steps:
      - checkout
      - run:
          name: Lint charts
          command: ct lint --all --chart-dirs platform/charts

  docs-build:
    docker:
      - image: squidfunk/mkdocs-material:6.1.6
    steps:
      - checkout
      - add_ssh_keys:
          fingerprints:
            - "95:21:09:e7:b3:a2:00:1a:1e:19:30:69:6b:2f:83:b5"
      - run:
          name: Publish docs to GitHub Pages
          command: mkdocs gh-deploy --strict --force
